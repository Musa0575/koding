<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Edukasi Pemrograman</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .game-header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeInDown 0.8s ease-out;
        }

        .game-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4c51bf;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .welcome-screen {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.8s ease-out;
        }

        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .level-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.6s ease-out;
        }

        .level-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .level-card:hover::before {
            left: 100%;
        }

        .level-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .level-card.completed {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            animation: pulse 2s infinite;
        }

        .level-card.locked {
            background: #9ca3af;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .game-screen {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: slideInRight 0.6s ease-out;
        }

        .progress-bar {
            background: #e5e7eb;
            border-radius: 10px;
            height: 20px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShine 2s infinite;
        }

        .timer-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .timer {
            background: #ef4444;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.2rem;
            animation: pulse 1s infinite;
            transition: all 0.3s ease;
        }

        .timer.warning {
            background: #f59e0b;
            animation: pulse 0.5s infinite;
        }

        .timer.danger {
            background: #ef4444;
            animation: pulse 0.3s infinite;
            transform: scale(1.1);
        }

        .question-container {
            background: #f8fafc;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #4c51bf;
            transition: all 0.3s ease;
            animation: fadeInLeft 0.6s ease-out;
        }

        .question-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #4c51bf;
            box-shadow: 0 0 0 3px rgba(76, 81, 191, 0.1);
            transform: scale(1.02);
        }

        .submit-btn {
            background: linear-gradient(135deg, #4c51bf 0%, #667eea 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
        }

        .submit-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .submit-btn:hover::after {
            width: 300px;
            height: 300px;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 81, 191, 0.4);
        }

        .submit-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
        }

        .feedback.correct {
            background: #dcfce7;
            color: #166534;
            border: 2px solid #22c55e;
            animation: bounceIn 0.6s ease-out;
        }

        .feedback.incorrect {
            background: #fef2f2;
            color: #dc2626;
            border: 2px solid #ef4444;
            animation: shake 0.5s ease-in-out;
        }

        .score-display {
            display: flex;
            justify-content: space-around;
            background: #f1f5f9;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            animation: slideInDown 0.6s ease-out;
        }

        .score-item {
            text-align: center;
        }

        .score-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4c51bf;
            animation: countUp 0.8s ease-out;
        }

        .score-label {
            font-size: 0.9rem;
            color: #64748b;
        }

        .results-screen {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: zoomIn 0.6s ease-out;
        }

        .trophy {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 1s ease-in-out infinite;
        }

        .btn {
            background: linear-gradient(135deg, #4c51bf 0%, #667eea 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .btn:hover::after {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 81, 191, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%);
        }

        .hidden {
            display: none;
        }

        .player-name-display {
            background: rgba(76, 81, 191, 0.1);
            border: 2px solid #4c51bf;
            border-radius: 25px;
            padding: 8px 15px;
            color: #4c51bf;
            font-weight: bold;
            font-size: 0.9rem;
            animation: slideInRight 0.6s ease-out;
            transition: all 0.3s ease;
        }

        .player-name-display:hover {
            background: rgba(76, 81, 191, 0.2);
            transform: scale(1.05);
        }

        .player-input {
            width: 300px;
            padding: 15px;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            font-size: 1.1rem;
            margin: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .player-input:focus {
            border-color: #4c51bf;
            box-shadow: 0 0 0 3px rgba(76, 81, 191, 0.1);
            transform: scale(1.05);
        }

        .leaderboard {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            animation: fadeInUp 0.6s ease-out;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
            transition: all 0.3s ease;
            animation: slideInLeft 0.4s ease-out;
        }

        .leaderboard-item:hover {
            background: #e2e8f0;
            transform: translateX(5px);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4c51bf;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Confetti and celebration effects */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confetti 3s linear infinite;
        }

        .sparkle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #fbbf24 0%, transparent 70%);
            border-radius: 50%;
            animation: sparkle 1.5s ease-in-out infinite;
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            z-index: 1001;
            animation: celebrationBounce 1s ease-in-out;
        }

        /* Keyframe animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0, -30px, 0);
            }
            70% {
                transform: translate3d(0, -15px, 0);
            }
            90% {
                transform: translate3d(0, -4px, 0);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.5);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes countUp {
            from {
                transform: scale(0.5);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes confetti {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes sparkle {
            0%, 100% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: scale(1) rotate(180deg);
                opacity: 1;
            }
        }

        @keyframes celebrationBounce {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <header class="game-header">
    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
     <div style="display: flex; align-items: center; gap: 15px; flex: 1; justify-content: center;">
      <svg width="50" height="50" viewbox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="10" y="20" width="80" height="60" fill="#4c51bf" rx="8" stroke="#312E81" stroke-width="2" /> <rect x="15" y="25" width="70" height="40" fill="#1e1b4b" rx="4" /> <circle cx="25" cy="75" r="4" fill="#fbbf24" /> <circle cx="35" cy="75" r="4" fill="#ef4444" /> <circle cx="45" cy="75" r="4" fill="#22c55e" /> <circle cx="55" cy="75" r="4" fill="#3b82f6" /> <rect x="65" y="72" width="8" height="6" fill="#9ca3af" rx="1" /> <rect x="75" y="72" width="8" height="6" fill="#9ca3af" rx="1" /> <text x="50" y="40" text-anchor="middle" fill="#22c55e" font-size="8" font-weight="bold">
        &lt;/&gt;
       </text> <rect x="25" y="50" width="15" height="2" fill="#fbbf24" rx="1" /> <rect x="45" y="50" width="20" height="2" fill="#ef4444" rx="1" /> <rect x="30" y="55" width="25" height="2" fill="#3b82f6" rx="1" /> <rect x="60" y="55" width="10" height="2" fill="#22c55e" rx="1" />
      </svg>
      <h1 class="game-title" id="gameTitle">Game Edukasi Pemrograman</h1>
     </div>
     <div id="playerNameDisplay" class="player-name-display hidden">
      <div style="display: flex; align-items: center; gap: 8px;">
       <svg width="24" height="24" viewbox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="35" r="20" fill="#4c51bf" /> <path d="M20 85 Q20 65 50 65 Q80 65 80 85" fill="#4c51bf" />
       </svg><span id="playerNameText"></span>
      </div>
     </div>
    </div>
   </header><!-- Welcome Screen -->
   <div id="welcomeScreen" class="welcome-screen">
    <h2 id="welcomeMessage">Selamat datang di Game Edukasi Pemrograman!</h2>
    <p>Uji pengetahuan Anda tentang konsep dasar pemrograman melalui 7 level yang menantang.</p><input type="text" id="playerName" class="player-input" placeholder="Masukkan nama Anda" maxlength="20"> <br><button class="btn" onclick="startGame()">Mulai Bermain</button> <button class="btn btn-secondary" onclick="showLeaderboard()">Papan Skor</button>
   </div><!-- Level Selection -->
   <div id="levelScreen" class="hidden">
    <div class="score-display">
     <div class="score-item">
      <div class="score-value" id="totalScore">
       0
      </div>
      <div class="score-label">
       Total Skor
      </div>
     </div>
     <div class="score-item">
      <div class="score-value" id="totalCorrect">
       0
      </div>
      <div class="score-label">
       Benar
      </div>
     </div>
     <div class="score-item">
      <div class="score-value" id="completedLevels">
       0
      </div>
      <div class="score-label">
       Level Selesai
      </div>
     </div>
    </div>
    <div class="level-grid" id="levelGrid"><!-- Level cards will be generated here -->
    </div>
    <div style="text-align: center;"><button class="btn btn-secondary" onclick="showWelcome()">Kembali</button>
    </div>
   </div><!-- Game Screen -->
   <div id="gameScreen" class="game-screen hidden">
    <div class="timer-container">
     <div><span>Level <span id="currentLevel">1</span> - Soal <span id="currentQuestion">1</span>/10</span>
     </div>
     <div class="timer" id="timer">
      30
     </div>
    </div>
    <div class="progress-bar">
     <div class="progress-fill" id="progressFill" style="width: 10%"></div>
    </div>
    <div class="question-container" id="questionContainer">
     <div class="question-text" id="questionText">
      Loading...
     </div><input type="text" id="answerInput" class="answer-input" placeholder="Ketik jawaban Anda di sini..." maxlength="100"> <button class="submit-btn" id="submitBtn" onclick="submitAnswer()">Kirim Jawaban</button>
     <div id="feedback" class="feedback hidden"></div>
    </div>
    <div style="text-align: center;"><button class="btn btn-secondary" onclick="showLevelScreen()">Kembali ke Level</button>
    </div>
   </div><!-- Results Screen -->
   <div id="resultsScreen" class="results-screen hidden">
    <div class="trophy" id="trophyIcon">
     ??
    </div>
    <h2 id="resultsTitle">Level Selesai!</h2>
    <div class="score-display">
     <div class="score-item">
      <div class="score-value" id="levelScore">
       0
      </div>
      <div class="score-label">
       Skor Level
      </div>
     </div>
     <div class="score-item">
      <div class="score-value" id="levelCorrect">
       0
      </div>
      <div class="score-label">
       Jawaban Benar
      </div>
     </div>
     <div class="score-item">
      <div class="score-value" id="levelTime">
       0
      </div>
      <div class="score-label">
       Waktu Tersisa
      </div>
     </div>
    </div>
    <p id="resultsMessage">Kerja bagus! Anda siap untuk level berikutnya.</p><button class="btn" id="nextLevelBtn" onclick="nextLevel()">Level Berikutnya</button> <button class="btn btn-secondary" onclick="showLevelScreen()">Pilih Level</button>
   </div><!-- Leaderboard -->
   <div id="leaderboardScreen" class="results-screen hidden">
    <h2>?? Papan Skor Teratas</h2>
    <div class="leaderboard" id="leaderboardList">
     <div style="text-align: center; padding: 20px;">
      <div class="loading"></div>
      <p>Memuat data...</p>
     </div>
    </div><button class="btn btn-secondary" onclick="showWelcome()">Kembali</button>
   </div>
  </div>
  <script>
        // Game configuration
        const defaultConfig = {
            game_title: "Game Edukasi Pemrograman",
            timer_duration: "30",
            welcome_message: "Selamat datang di Game Edukasi Pemrograman!"
        };

        let config = { ...defaultConfig };
        let gameData = [];
        let currentRecordCount = 0;

        // Game state
        let currentPlayer = '';
        let currentLevelIndex = 0;
        let currentQuestionIndex = 0;
        let currentScore = 0;
        let levelScore = 0;
        let correctAnswers = 0;
        let timeLeft = 30;
        let timerInterval = null;
        let playerProgress = {
            completedLevels: 0,
            totalScore: 0,
            totalCorrect: 0,
            levelScores: []
        };

        // Questions database
        const levels = [
            {
                name: "Algoritma",
                icon: `<svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="#4F46E5" stroke="#312E81" stroke-width="3"/>
                    <path d="M30 35 L50 25 L70 35 L50 45 Z" fill="#FFF" opacity="0.9"/>
                    <path d="M30 45 L50 35 L70 45 L50 55 Z" fill="#FFF" opacity="0.7"/>
                    <path d="M30 55 L50 45 L70 55 L50 65 Z" fill="#FFF" opacity="0.5"/>
                    <circle cx="35" cy="75" r="3" fill="#FFF"/>
                    <circle cx="50" cy="75" r="3" fill="#FFF"/>
                    <circle cx="65" cy="75" r="3" fill="#FFF"/>
                </svg>`,
                questions: [
                    { q: "Apa definisi algoritma dalam pemrograman?", a: "urutan langkah logis untuk menyelesaikan masalah" },
                    { q: "Sebutkan 3 karakteristik algoritma yang baik!", a: "jelas, terbatas, efektif" },
                    { q: "Apa yang dimaksud dengan pseudocode?", a: "kode semu yang menggambarkan algoritma" },
                    { q: "Algoritma harus memiliki sifat apa agar dapat berhenti?", a: "terbatas" },
                    { q: "Apa perbedaan algoritma dan program?", a: "algoritma adalah konsep, program adalah implementasi" },
                    { q: "Sebutkan salah satu contoh algoritma dalam kehidupan sehari-hari!", a: "resep masakan" },
                    { q: "Siapa nama tokoh yang identik dengan algoritma?", a: "Ibu Musa, Abu Jabar, Alhawarizmi" },
                    { q: "Apakah algoritma bisa diterapkan dalam semua bidang?", a: "bisa, tentu, pasti" },
                    { q: "Langkah terakhir dalam membuat algoritma adalah …?", a: "menguji, mencoba, menjalankan" },
                    { q: "Yang bukan termasuk ciri-ciri algoritma yang baik ...", a: "mengulang, tidak jelas, tidak terstruktur" }
                ]
            },
            {
                name: "Flowchart",
                icon: `<svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="10" y="10" width="80" height="80" fill="#10B981" rx="8"/>
                    <ellipse cx="50" cy="25" rx="15" ry="8" fill="#FFF"/>
                    <rect x="35" y="40" width="30" height="15" fill="#FFF"/>
                    <path d="M35 65 L50 55 L65 65 L50 75 Z" fill="#FFF"/>
                    <path d="M50 33 L50 40" stroke="#FFF" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <path d="M50 55 L50 55" stroke="#FFF" stroke-width="2"/>
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#FFF"/>
                        </marker>
                    </defs>
                </svg>`,
                questions: [
                    { q: "Apa fungsi flowchart dalam pemrograman?", a: "bagan, alur, simbol urutan" },
                    { q: "Simbol apa yang digunakan untuk proses dalam flowchart?", a: "persegi panjang" },
                    { q: "Simbol apa yang digunakan untuk keputusan dalam flowchart?", a: "belah ketupat" },
                    { q: "Simbol apa yang digunakan untuk input/output dalam flowchart?", a: "jajar genjang" },
                    { q: "Simbol apa yang digunakan untuk start/end dalam flowchart?", a: "oval" },
                    { q: "Apa yang menghubungkan simbol-simbol dalam flowchart?", a: "panah, atau garis alur" },
                    { q: "Flowchart harus dibaca dari arah mana?", a: "atas ke bawah" },
                    { q: "Apa kegunaan connector dalam flowchart?", a: "menghubungkan bagian yang terpisah" },
                    { q: "Berapa maksimal jalur keluar dari simbol keputusan?", a: "dua" },
                    { q: "Apa yang dimaksud dengan loop dalam flowchart?", a: "pengulangan proses" }
                ]
            },
            {
                name: "Variable",
                icon: `<svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="15" y="25" width="70" height="50" fill="#F59E0B" rx="8" stroke="#D97706" stroke-width="2"/>
                    <rect x="25" y="35" width="15" height="8" fill="#FFF" rx="2"/>
                    <rect x="45" y="35" width="20" height="8" fill="#FFF" rx="2"/>
                    <rect x="25" y="50" width="25" height="8" fill="#FFF" rx="2"/>
                    <rect x="55" y="50" width="15" height="8" fill="#FFF" rx="2"/>
                    <text x="50" y="20" text-anchor="middle" fill="#D97706" font-size="12" font-weight="bold">VAR</text>
                </svg>`,
                questions: [
                    { q: "Apa definisi variable dalam pemrograman?", a: "tempat, menyimpan data, suatu bisa berubah" },
                    { q: "Apa aturan penamaan variable yang benar?", a: "dimulai huruf, tidak boleh spasi" },
                    { q: "Tuliskan pembuatan variable yang benar?", a: "nama = 'aku', a=123" },
                    { q: "Jika kita menulis perintah: x = 10", a: "menyimpan angka 10, menaruh angka 10" },
                    { q: "Bisakah nama variable dimulai dengan angka?", a: "tidak" },
                    { q: "Apa yang terjadi jika variable tidak diinisialisasi?", a: "error, tidak dibaca" },
                    { q: "Sebutkan contoh nama variable yang valid!", a: "nama_siswa" },
                    { q: "Tipe data yang digunakan untuk menyimpan teks atau huruf adalah …", a: "sting, text" },
                    { q: "Jika kita menulis a = 5 dan b = 3, maka nilai a + b adalah …?", a: "8, delapan" },
                    { q: "Jika dalam program ditulis harga = 5000 jumlah = 3 total = harga * jumlah:?", a: "15000" }
                ]
            },
            {
                name: "Tipe Data",
                icon: `<svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="10" y="10" width="80" height="80" fill="#8B5CF6" rx="12"/>
                    <rect x="20" y="25" width="25" height="15" fill="#FFF" rx="3"/>
                    <text x="32.5" y="35" text-anchor="middle" fill="#8B5CF6" font-size="10" font-weight="bold">123</text>
                    <rect x="55" y="25" width="25" height="15" fill="#FFF" rx="3"/>
                    <text x="67.5" y="35" text-anchor="middle" fill="#8B5CF6" font-size="8" font-weight="bold">ABC</text>
                    <rect x="20" y="50" width="25" height="15" fill="#FFF" rx="3"/>
                    <circle cx="32.5" cy="57.5" r="3" fill="#8B5CF6"/>
                    <rect x="55" y="50" width="25" height="15" fill="#FFF" rx="3"/>
                    <text x="67.5" y="60" text-anchor="middle" fill="#8B5CF6" font-size="8" font-weight="bold">T/F</text>
                </svg>`,
                questions: [
                    { q: "Sebutkan 3 tipe data primitif dalam pemrograman!", a: "integer, string, boolean" },
                    { q: "Apa tipe data untuk menyimpan teks?", a: "string" },
                    { q: "Apa tipe data untuk menyimpan angka bulat?", a: "integer" },
                    { q: "Apa tipe data untuk menyimpan nilai benar/salah?", a: "boolean" },
                    { q: "Apa tipe data untuk menyimpan angka desimal?", a: "float" },
                    { q: "Apa yang dimaksud dengan array?", a: "kumpulan data dengan tipe sama" },
                    { q: "Bagaimana cara mendeklarasikan string dalam JavaScript?", a: "menggunakan tanda kutip" },
                    { q: "Apa nilai boolean yang mungkin?", a: "true dan false" },
                    { q: "Apa perbedaan int dan float?", a: "int untuk bilangan bulat, float untuk desimal" },
                    { q: "Apa yang dimaksud dengan null?", a: "nilai kosong atau tidak ada" }
                ]
            },
            {
                name: "Konstanta",
                icon: `<svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="15" y="45" width="70" height="40" fill="#DC2626" rx="8"/>
                    <rect x="35" y="25" width="30" height="25" fill="none" stroke="#DC2626" stroke-width="4" rx="15"/>
                    <circle cx="50" cy="65" r="6" fill="#FFF"/>
                    <rect x="47" y="68" width="6" height="10" fill="#FFF" rx="1"/>
                    <text x="50" y="95" text-anchor="middle" fill="#DC2626" font-size="8" font-weight="bold">CONST</text>
                </svg>`,
                questions: [
                    { q: "Apa definisi konstanta dalam pemrograman?", a: "nilai yang tidak dapat diubah" },
                    { q: "Apa perbedaan konstanta dan variable?", a: "konstanta tidak bisa diubah setelah dideklarasi" },
                    { q: "Bagaimana cara mendeklarasikan konstanta dalam JavaScript?", a: "menggunakan keyword const" },
                    { q: "Apa keuntungan menggunakan konstanta?", a: "mencegah perubahan nilai yang tidak diinginkan" },
                    { q: "Bisakah konstanta diubah nilainya?", a: "tidak" },
                    { q: "Apa konvensi penamaan konstanta?", a: "menggunakan huruf kapital semua" },
                    { q: "Sebutkan contoh penggunaan konstanta!", a: "PI untuk nilai 3.14159" },
                    { q: "Apa yang terjadi jika mencoba mengubah konstanta?", a: "akan terjadi error" },
                    { q: "Kapan sebaiknya menggunakan konstanta?", a: "untuk nilai yang pasti tidak berubah" },
                    { q: "Apa keyword untuk konstanta dalam bahasa C?", a: "const" }
                ]
            },
            {
                name: "Operator",
                icon: `<svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="#06B6D4" stroke="#0891B2" stroke-width="3"/>
                    <rect x="35" y="47" width="30" height="6" fill="#FFF" rx="3"/>
                    <rect x="47" y="35" width="6" height="30" fill="#FFF" rx="3"/>
                    <circle cx="25" cy="25" r="4" fill="#FFF"/>
                    <circle cx="75" cy="25" r="4" fill="#FFF"/>
                    <rect x="20" y="70" width="12" height="6" fill="#FFF" rx="3"/>
                    <rect x="68" y="70" width="12" height="6" fill="#FFF" rx="3"/>
                </svg>`,
                questions: [
                    { q: "Sebutkan 3 jenis operator dalam pemrograman!", a: "aritmatika, perbandingan, logika" },
                    { q: "Apa fungsi operator + dalam pemrograman?", a: "penjumlahan atau penggabungan string" },
                    { q: "Apa hasil dari operator == dalam JavaScript?", a: "perbandingan nilai" },
                    { q: "Apa perbedaan == dan === dalam JavaScript?", a: "== membandingkan nilai, === membandingkan nilai dan tipe" },
                    { q: "Apa fungsi operator && dalam logika?", a: "operasi AND" },
                    { q: "Apa fungsi operator || dalam logika?", a: "operasi OR" },
                    { q: "Apa hasil dari 5 % 2?", a: "1" },
                    { q: "Apa fungsi operator ++ dalam pemrograman?", a: "increment atau menambah 1" },
                    { q: "Apa fungsi operator -- dalam pemrograman?", a: "decrement atau mengurang 1" },
                    { q: "Apa yang dimaksud dengan operator ternary?", a: "operator kondisi dengan 3 operand" }
                ]
            },
            {
                name: "Fungsi IF",
                icon: `<svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="10" y="10" width="80" height="80" fill="#EC4899" rx="12"/>
                    <path d="M50 25 L35 45 L65 45 Z" fill="#FFF"/>
                    <text x="50" y="40" text-anchor="middle" fill="#EC4899" font-size="8" font-weight="bold">IF</text>
                    <rect x="20" y="55" width="20" height="12" fill="#FFF" rx="2"/>
                    <text x="30" y="63" text-anchor="middle" fill="#EC4899" font-size="6" font-weight="bold">TRUE</text>
                    <rect x="60" y="55" width="20" height="12" fill="#FFF" rx="2"/>
                    <text x="70" y="63" text-anchor="middle" fill="#EC4899" font-size="6" font-weight="bold">FALSE</text>
                    <path d="M42 45 L30 55" stroke="#FFF" stroke-width="2"/>
                    <path d="M58 45 L70 55" stroke="#FFF" stroke-width="2"/>
                </svg>`,
                questions: [
                    { q: "Apa fungsi statement IF dalam pemrograman?", a: "membuat keputusan berdasarkan kondisi" },
                    { q: "Apa yang dimaksud dengan kondisi dalam IF?", a: "ekspresi yang menghasilkan true atau false" },
                    { q: "Apa perbedaan IF dan IF-ELSE?", a: "IF-ELSE memiliki alternatif jika kondisi false" },
                    { q: "Bagaimana struktur IF statement yang benar?", a: "if (kondisi) { aksi }" },
                    { q: "Apa yang dimaksud dengan nested IF?", a: "IF di dalam IF" },
                    { q: "Kapan blok ELSE akan dieksekusi?", a: "ketika kondisi IF bernilai false" },
                    { q: "Apa fungsi ELSE IF dalam pemrograman?", a: "menambah kondisi alternatif" },
                    { q: "Bisakah IF statement tanpa kurung kurawal?", a: "ya, untuk satu statement" },
                    { q: "Apa yang terjadi jika kondisi IF kosong?", a: "akan error atau dianggap false" },
                    { q: "Sebutkan contoh kondisi dalam IF statement!", a: "x > 10" }
                ]
            }
        ];

        // Visual effects functions
        function createConfetti() {
            const container = document.createElement('div');
            container.className = 'confetti-container';
            document.body.appendChild(container);

            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                container.appendChild(confetti);
            }

            setTimeout(() => {
                container.remove();
            }, 5000);
        }

        function createSparkles() {
            const container = document.querySelector('.question-container');
            
            for (let i = 0; i < 8; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 1 + 's';
                container.appendChild(sparkle);

                setTimeout(() => {
                    sparkle.remove();
                }, 2000);
            }
        }

        function createSuccessEffect() {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.textContent = '??';
            document.body.appendChild(celebration);

            setTimeout(() => {
                celebration.remove();
            }, 1000);
        }

        function createShakeEffect() {
            const questionContainer = document.getElementById('questionContainer');
            questionContainer.style.animation = 'shake 0.5s ease-in-out';
            
            setTimeout(() => {
                questionContainer.style.animation = '';
            }, 500);
        }

        function updateTimerStyle() {
            const timer = document.getElementById('timer');
            if (timeLeft <= 5) {
                timer.className = 'timer danger';
            } else if (timeLeft <= 10) {
                timer.className = 'timer warning';
            } else {
                timer.className = 'timer';
            }
        }

        // Data SDK handler
        const dataHandler = {
            onDataChanged(data) {
                gameData = data;
                currentRecordCount = data.length;
                updateLeaderboard();
            }
        };

        // Element SDK implementation
        const element = {
            defaultConfig,
            render: async (newConfig) => {
                config = { ...defaultConfig, ...newConfig };
                
                // Update game title
                const titleElement = document.getElementById('gameTitle');
                if (titleElement) {
                    titleElement.textContent = config.game_title || defaultConfig.game_title;
                }
                
                // Update welcome message
                const welcomeElement = document.getElementById('welcomeMessage');
                if (welcomeElement) {
                    welcomeElement.textContent = config.welcome_message || defaultConfig.welcome_message;
                }
                
                // Update timer duration
                timeLeft = parseInt(config.timer_duration) || 30;
                const timerElement = document.getElementById('timer');
                if (timerElement && !timerInterval) {
                    timerElement.textContent = timeLeft;
                }
            },
            mapToCapabilities: (config) => ({
                recolorables: [
                    {
                        get: () => config.primary_color || "#4c51bf",
                        set: (value) => {
                            config.primary_color = value;
                            window.elementSdk.setConfig({ primary_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: {
                    get: () => config.font_family || "Segoe UI",
                    set: (value) => {
                        config.font_family = value;
                        window.elementSdk.setConfig({ font_family: value });
                    }
                },
                fontSizeable: {
                    get: () => config.font_size || 16,
                    set: (value) => {
                        config.font_size = value;
                        window.elementSdk.setConfig({ font_size: value });
                    }
                }
            }),
            mapToEditPanelValues: (config) => new Map([
                ["game_title", config.game_title || defaultConfig.game_title],
                ["timer_duration", config.timer_duration || defaultConfig.timer_duration],
                ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
            ])
        };

        // Initialize SDKs
        async function initializeApp() {
            try {
                if (window.dataSdk) {
                    const initResult = await window.dataSdk.init(dataHandler);
                    if (!initResult.isOk) {
                        console.error("Failed to initialize data SDK");
                    }
                }

                if (window.elementSdk) {
                    await window.elementSdk.init(element);
                }

                generateLevelCards();
            } catch (error) {
                console.error("Initialization error:", error);
            }
        }

        // Game functions
        function startGame() {
            const nameInput = document.getElementById('playerName');
            if (!nameInput.value.trim()) {
                showCustomAlert('Silakan masukkan nama Anda terlebih dahulu!');
                return;
            }
            
            currentPlayer = nameInput.value.trim();
            updatePlayerNameDisplay();
            loadPlayerProgress();
            showLevelScreen();
        }

        function updatePlayerNameDisplay() {
            const playerNameDisplay = document.getElementById('playerNameDisplay');
            const playerNameText = document.getElementById('playerNameText');
            
            if (currentPlayer) {
                playerNameText.textContent = currentPlayer;
                playerNameDisplay.classList.remove('hidden');
            } else {
                playerNameDisplay.classList.add('hidden');
            }
        }

        function loadPlayerProgress() {
            const playerData = gameData.find(record => record.player_name === currentPlayer);
            if (playerData) {
                playerProgress.completedLevels = playerData.current_level - 1;
                playerProgress.totalScore = playerData.score || 0;
                playerProgress.totalCorrect = playerData.total_correct || 0;
                playerProgress.levelScores = playerData.level_scores ? JSON.parse(playerData.level_scores) : [];
            } else {
                playerProgress = {
                    completedLevels: 0,
                    totalScore: 0,
                    totalCorrect: 0,
                    levelScores: []
                };
            }
            updateProgressDisplay();
        }

        function updateProgressDisplay() {
            document.getElementById('totalScore').textContent = playerProgress.totalScore;
            document.getElementById('totalCorrect').textContent = playerProgress.totalCorrect;
            document.getElementById('completedLevels').textContent = playerProgress.completedLevels;
        }

        function generateLevelCards() {
            const levelGrid = document.getElementById('levelGrid');
            levelGrid.innerHTML = '';
            
            levels.forEach((level, index) => {
                const card = document.createElement('button');
                card.className = 'level-card';
                card.style.animationDelay = (index * 0.1) + 's';
                
                if (index < playerProgress.completedLevels) {
                    card.classList.add('completed');
                } else if (index > playerProgress.completedLevels) {
                    card.classList.add('locked');
                }
                
                card.innerHTML = `
                    <div style="margin-bottom: 10px; display: flex; justify-content: center;">${level.icon}</div>
                    <div>Level ${index + 1}</div>
                    <div style="font-size: 0.9rem; margin-top: 5px;">${level.name}</div>
                    ${playerProgress.levelScores[index] ? `<div style="font-size: 0.8rem; color: #fbbf24;">Skor: ${playerProgress.levelScores[index]}</div>` : ''}
                `;
                
                if (index <= playerProgress.completedLevels) {
                    card.onclick = () => startLevel(index);
                }
                
                levelGrid.appendChild(card);
            });
        }

        function startLevel(levelIndex) {
            currentLevelIndex = levelIndex;
            currentQuestionIndex = 0;
            levelScore = 0;
            correctAnswers = 0;
            
            showGameScreen();
            loadQuestion();
            startTimer();
        }

        function loadQuestion() {
            const level = levels[currentLevelIndex];
            const question = level.questions[currentQuestionIndex];
            
            document.getElementById('currentLevel').textContent = currentLevelIndex + 1;
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.q;
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').focus();
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('submitBtn').disabled = false;
            
            const progress = ((currentQuestionIndex + 1) / 10) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function startTimer() {
            timeLeft = parseInt(config.timer_duration) || 30;
            document.getElementById('timer').textContent = timeLeft;
            updateTimerStyle();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                updateTimerStyle();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitAnswer(true);
                }
            }, 1000);
        }

        function submitAnswer(timeUp = false) {
            clearInterval(timerInterval);
            
            const userAnswer = document.getElementById('answerInput').value.trim().toLowerCase();
            const correctAnswer = levels[currentLevelIndex].questions[currentQuestionIndex].a.toLowerCase();
            
            // Check if user actually provided an answer
            const hasAnswer = userAnswer.length > 0;
            
            // More strict answer checking - require minimum 3 characters and better matching
            let isCorrect = false;
            if (hasAnswer && userAnswer.length >= 3) {
                // Split correct answer into key words
                const correctWords = correctAnswer.split(/[\s,]+/).filter(word => word.length >= 3);
                const userWords = userAnswer.split(/[\s,]+/).filter(word => word.length >= 3);
                
                // Check if user answer contains significant portion of correct answer
                const matchCount = correctWords.filter(correctWord => 
                    userWords.some(userWord => 
                        userWord.includes(correctWord) || correctWord.includes(userWord)
                    )
                ).length;
                
                // Require at least 50% of key words to match, or exact substring match for longer answers
                isCorrect = (matchCount >= Math.ceil(correctWords.length * 0.5)) || 
                           (userAnswer.length >= 10 && correctAnswer.includes(userAnswer)) ||
                           (correctAnswer.length >= 10 && userAnswer.includes(correctAnswer));
            }
            
            const feedback = document.getElementById('feedback');
            feedback.classList.remove('hidden');
            
            if (timeUp) {
                feedback.textContent = `? Waktu habis! Jawaban yang benar: ${levels[currentLevelIndex].questions[currentQuestionIndex].a}`;
                feedback.className = 'feedback incorrect';
                createShakeEffect();
            } else if (!hasAnswer) {
                feedback.textContent = `? Anda belum menjawab! Jawaban yang benar: ${levels[currentLevelIndex].questions[currentQuestionIndex].a}`;
                feedback.className = 'feedback incorrect';
                createShakeEffect();
            } else if (hasAnswer && userAnswer.length < 3) {
                feedback.textContent = `? Jawaban terlalu pendek! Minimal 3 karakter. Jawaban yang benar: ${levels[currentLevelIndex].questions[currentQuestionIndex].a}`;
                feedback.className = 'feedback incorrect';
                createShakeEffect();
            } else if (isCorrect) {
                feedback.textContent = '? Benar! Jawaban Anda tepat.';
                feedback.className = 'feedback correct';
                correctAnswers++;
                levelScore += timeLeft * 10; // Bonus based on remaining time
                createSuccessEffect();
                createSparkles();
            } else {
                feedback.textContent = `? Salah. Jawaban yang benar: ${levels[currentLevelIndex].questions[currentQuestionIndex].a}`;
                feedback.className = 'feedback incorrect';
                createShakeEffect();
            }
            
            document.getElementById('submitBtn').disabled = true;
            
            setTimeout(() => {
                nextQuestion();
            }, 2000);
        }

        function nextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= 10) {
                finishLevel();
            } else {
                loadQuestion();
                startTimer();
            }
        }

        function finishLevel() {
            playerProgress.levelScores[currentLevelIndex] = levelScore;
            playerProgress.totalScore += levelScore;
            playerProgress.totalCorrect += correctAnswers;
            
            if (currentLevelIndex >= playerProgress.completedLevels) {
                playerProgress.completedLevels = currentLevelIndex + 1;
            }
            
            savePlayerProgress();
            showResults();
            
            // Create confetti for level completion
            if (correctAnswers >= 5) {
                createConfetti();
            }
        }

        async function savePlayerProgress() {
            if (!window.dataSdk) return;
            
            if (currentRecordCount >= 999) {
                showCustomAlert("Batas maksimum 999 pemain telah tercapai. Silakan hapus beberapa data terlebih dahulu.");
                return;
            }
            
            const existingRecord = gameData.find(record => record.player_name === currentPlayer);
            
            const playerData = {
                player_name: currentPlayer,
                current_level: playerProgress.completedLevels + 1,
                current_question: 1,
                score: playerProgress.totalScore,
                total_correct: playerProgress.totalCorrect,
                level_scores: JSON.stringify(playerProgress.levelScores),
                completed_at: new Date().toISOString()
            };
            
            try {
                let result;
                if (existingRecord) {
                    result = await window.dataSdk.update({ ...existingRecord, ...playerData });
                } else {
                    result = await window.dataSdk.create(playerData);
                }
                
                if (!result.isOk) {
                    showCustomAlert("Gagal menyimpan progress. Silakan coba lagi.");
                }
            } catch (error) {
                showCustomAlert("Terjadi kesalahan saat menyimpan data.");
            }
        }

        function showResults() {
            document.getElementById('levelScore').textContent = levelScore;
            document.getElementById('levelCorrect').textContent = correctAnswers;
            document.getElementById('levelTime').textContent = timeLeft;
            
            const resultsTitle = document.getElementById('resultsTitle');
            const resultsMessage = document.getElementById('resultsMessage');
            const trophyIcon = document.getElementById('trophyIcon');
            const nextLevelBtn = document.getElementById('nextLevelBtn');
            
            if (correctAnswers >= 7) {
                trophyIcon.textContent = '??';
                resultsTitle.textContent = 'Luar Biasa!';
                resultsMessage.textContent = 'Anda menguasai materi ini dengan sangat baik!';
            } else if (correctAnswers >= 5) {
                trophyIcon.textContent = '??';
                resultsTitle.textContent = 'Bagus!';
                resultsMessage.textContent = 'Anda cukup memahami materi ini.';
            } else {
                trophyIcon.textContent = '??';
                resultsTitle.textContent = 'Perlu Belajar Lagi';
                resultsMessage.textContent = 'Jangan menyerah! Coba pelajari materi sekali lagi.';
            }
            
            if (currentLevelIndex + 1 >= levels.length) {
                nextLevelBtn.textContent = 'Selesai';
                nextLevelBtn.onclick = showLevelScreen;
            } else {
                nextLevelBtn.textContent = 'Level Berikutnya';
                nextLevelBtn.onclick = nextLevel;
            }
            
            showScreen('resultsScreen');
        }

        function nextLevel() {
            if (currentLevelIndex + 1 < levels.length) {
                startLevel(currentLevelIndex + 1);
            } else {
                showLevelScreen();
            }
        }

        function updateLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            
            if (gameData.length === 0) {
                leaderboardList.innerHTML = '<div style="text-align: center; padding: 20px;">Belum ada data pemain.</div>';
                return;
            }
            
            const sortedData = [...gameData]
                .sort((a, b) => (b.score || 0) - (a.score || 0))
                .slice(0, 10);
            
            leaderboardList.innerHTML = sortedData.map((player, index) => `
                <div class="leaderboard-item" style="animation-delay: ${index * 0.1}s">
                    <span>${index + 1}. ${player.player_name}</span>
                    <span>${player.score || 0} poin</span>
                </div>
            `).join('');
        }

        function showLeaderboard() {
            updateLeaderboard();
            showScreen('leaderboardScreen');
        }

        // Screen navigation with animations
        function showScreen(screenId) {
            const screens = ['welcomeScreen', 'levelScreen', 'gameScreen', 'resultsScreen', 'leaderboardScreen'];
            screens.forEach(id => {
                const screen = document.getElementById(id);
                if (id === screenId) {
                    screen.classList.remove('hidden');
                    // Add entrance animation
                    screen.style.animation = 'fadeInUp 0.6s ease-out';
                } else {
                    screen.classList.add('hidden');
                }
            });
        }

        function showWelcome() {
            currentPlayer = '';
            updatePlayerNameDisplay();
            showScreen('welcomeScreen');
        }

        function showLevelScreen() {
            generateLevelCards();
            updateProgressDisplay();
            showScreen('levelScreen');
        }

        function showGameScreen() {
            showScreen('gameScreen');
        }

        // Custom alert function (no browser dialogs)
        function showCustomAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ef4444;
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                max-width: 300px;
                font-weight: bold;
                animation: slideInRight 0.3s ease-out;
            `;
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.style.animation = 'slideInLeft 0.3s ease-out reverse';
                setTimeout(() => {
                    alertDiv.remove();
                }, 300);
            }, 3000);
        }

        // Event listeners
        document.getElementById('answerInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                submitAnswer();
            }
        });

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99260dd141fb0d3d',t:'MTc2MTEwNTI3Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>